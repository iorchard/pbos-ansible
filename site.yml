---
- name: Deploy common service
  hosts: all
  any_errors_fatal: true
  roles:
    - {role: pbos.common, tags: always}

- name: Deploy time service (ntp)
  hosts: all
  any_errors_fatal: true
  roles:
    - {role: pbos.ntp, tags: ntp}

- name: Deploy storage service (ceph)
  hosts: ceph
  any_errors_fatal: true
  roles:
    - {role: pbos.ceph, tags: ceph}

- name: Deploy cache service (memcached)
  hosts: controller
  any_errors_fatal: true
  roles:
    - {role: pbos.memcached, tags: memcached}

- name: Deploy database service (mariadb galera cluster)
  hosts: mariadb
  any_errors_fatal: true
  roles:
    - {role: pbos.mariadb, tags: mariadb}

- name: Deploy messaging service (rabbitmq)
  hosts: rabbitmq
  any_errors_fatal: true
  roles:
    - {role: pbos.rabbitmq, tags: rabbitmq}

- name: Deploy HA service (keepalived/haproxy)
  hosts: controller
  any_errors_fatal: true
  roles:
    - {role: pbos.haproxy, tags: haproxy}
    - {role: pbos.keepalived, tags: keepalived}

- name: Deploy openstack identity service (keystone)
  hosts: keystone
  any_errors_fatal: true
  roles:
    - {role: pbos.keystone, tags: keystone}

- name: Deploy openstack image service (glance)
  hosts: glance
  any_errors_fatal: true
  roles:
    - {role: pbos.glance, tags: glance}

- name: Deploy openstack resource service (placement)
  hosts: placement
  any_errors_fatal: true
  roles:
    - {role: pbos.placement, tags: placement}

- name: Deploy openstack network service (neutron)
  hosts: openstack
  any_errors_fatal: true
  roles:
    - {role: pbos.neutron, tags: neutron}

- name: Deploy openstack volume service (cinder)
  hosts: cinder
  any_errors_fatal: true
  roles:
    - {role: pbos.cinder, tags: cinder}

- name: Deploy openstack compute service (nova)
  hosts: openstack
  any_errors_fatal: true
  roles:
    - {role: pbos.nova, tags: nova}

- name: Deploy openstack dashboard service (horizon)
  hosts: controller
  any_errors_fatal: true
  roles:
    - {role: pbos.horizon, tags: horizon}

- name: Deploy openstack key management service (barbican)
  hosts: barbican
  any_errors_fatal: true
  roles:
    - {role: pbos.barbican, tags: barbican}
...
